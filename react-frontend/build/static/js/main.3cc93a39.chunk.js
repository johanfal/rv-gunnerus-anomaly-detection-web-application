(this["webpackJsonpreact-frontend"]=this["webpackJsonpreact-frontend"]||[]).push([[0],{114:function(e,t,a){e.exports=a(159)},119:function(e,t,a){},154:function(e,t){},159:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),l=a(65),r=a.n(l),i=(a(119),a(49),a(4)),o=a(5),c=a(3),d=a(6),u=a(7),p=function(){return s.a.createElement("div",{className:"about-container"},"This application allows users to upload and test machine learning models, developed sequentially through"," ",s.a.createElement("a",{className:"about-link",href:"https://www.tensorflow.org/",target:"_blank",rel:"noopener noreferrer"},"TensorFlow")," ","and"," ",s.a.createElement("a",{className:"about-link",href:"https://keras.io/",target:"_blank",rel:"noopener noreferrer"},"Keras"),", aimed at anomaly detection for predictive maintenance. After uploading the desired model (and corresponding scaler) for testing, the user can view data streams in real-time for available signals of a selected system transmitting data. For predicted signals, the user can set threshold values for anomaly detection, and successive values exceeding the given thresholds are presented visually as anomalies.",s.a.createElement("br",null),s.a.createElement("br",null),"Currently, NTNU's research vessel, R/V Gunnerus, is used as a data source for implementing anomaly detection models and subsequent testing in this application. At the time of launch, the application database only supports one system aboard the vessel, namely the Nogva main engines. Historical data is supplied from the server from an interval where a simulated fault was triggered, causing the exhaust temperatures to rise. Although the current implementation uses historical data, the application is easily modified to receive data from a server updating in real-time. In addition to this web application, a modeling API was developed, providing the framework for developing recurrent neural network (RNN) models.",s.a.createElement("br",null),s.a.createElement("br",null),"The application was made as part of a Master's assignment in marine technology at the Norwegian University of Science and Technology, NTNU. The application intends to serve as a tool used in the education of engineering students, and is especially related to the development and use of digital twins in maritime applications at the Department of Marine Technology.",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("img",{id:"gunnerus-rendering",src:"./img/gunnerus_rendering_green.png",alt:"Gunnerus digital twin rendering"}),s.a.createElement("div",{style:{textAlign:"center",fontSize:"16px"}},s.a.createElement("em",null,"Rendering of R/V Gunnerus and a virtual twin")))},m=a(10),h=a(11),f=a(17),g=a.n(f),v=a(1),b=["LINE","AREA"],S=function(){function e(){var t=this;Object(i.a)(this,e),this.elRef=null,this.margin={top:10,right:20,bottom:30,left:50},this.responsiveHeight=!1,this.responsiveWidth=!1,this.xScale=v.l(),this.yScale=v.k(),this.seriesDict={},this.toggleSeries=function(e){if(e){var a=t.seriesDict[e],n=a.ref.classed("hidden");a.ref.classed("hidden",!n)}}}return Object(o.a)(e,[{key:"init",value:function(e){var t=e.elRef,a=e.width,n=e.height,s=e.classList;this.elRef=t,void 0===a&&(this.responsiveWidth=!0),void 0===n&&(this.responsiveHeight=!0),this.outerWidth=a||this.elRef.offsetWidth,this.outerHeight=n||this.elRef.offsetHeight,this.classList=s||{},this.draw()}},{key:"draw",value:function(){this.svg=v.m(this.elRef).append("svg").attr("width",this.outerWidth).attr("height",this.outerHeight).classed(this.classList.svg||null,!0),this.group=this.svg.append("g").attr("width",this.outerWidth-this.margin.left-this.margin.right).attr("height",this.outerHeight-this.margin.top-this.margin.bottom).attr("transform","translate(".concat(this.margin.left," , ").concat(this.margin.top,")")).classed(this.classList.group||null,!0),this.xScale.range([0,this.outerWidth-this.margin.left-this.margin.right]),this.xAxisRef=this.group.append("g").attr("transform","translate(0,".concat(this.outerHeight-this.margin.bottom,")")).classed("x-axis",!0),this.yScale.range([this.outerHeight-this.margin.bottom,0]),this.yAxisRef=this.group.append("g").attr("transform","translate(0, 0)").classed("y-axis",!0)}},{key:"addSeries",value:function(e){var t=e.name,a=e.type,n=e.fill,s=e.stroke,l=e.strokeWidth;e.id;if(this.seriesDict[t])throw new Error("Series name must be unique!");if(!b.includes(a))throw new Error("Series type not supported!");this.seriesDict[t]={type:a,ref:this.group.append("path").attr("fill",n||"none").attr("stroke",s||"black").attr("stroke-width",l||2).classed("series",!0).classed("hidden",!1)}}},{key:"setSeriesData",value:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.seriesDict[e];switch(this.adjustDimensions(),a&&this.adjustAxes(t),n.type){case"AREA":this.updateAreaSeries(n,t);break;case"LINE":default:"prediction"===e?this.updatePredictionSeries(n,t):this.updateLineSeries(n,t)}}},{key:"updateLineSeries",value:function(e,t){var a=this;e.ref.datum(t).transition().duration(100).ease(v.e).attr("d",v.h().x((function(e){return a.xScale(e.timestamp)})).y((function(e){return a.yScale(e.value)})))}},{key:"updatePredictionSeries",value:function(e,t){var a=this;e.ref.datum(t).transition().duration(100).ease(v.e).attr("d",v.h().x((function(e){return a.xScale(e.timestamp)})).y((function(e){return a.yScale(e.pred)})))}},{key:"updateAreaSeries",value:function(e,t){var a=this;e.ref.datum(t).transition().duration(100).ease(v.e).attr("d",v.a().x((function(e){return a.xScale(e.timestamp)})).y0(this.yScale(0)).y1((function(e){return a.yScale(e.value)})))}},{key:"adjustAxes",value:function(e,t){var a,n;if(t){var s=v.j(e,(function(e){return e.value})),l=v.j(e,(function(e){return e.pred}));a=Math.floor(10*Math.min(s,l))/10;var r=v.i(e,(function(e){return e.value})),i=v.i(e,(function(e){return e.pred}));n=Math.ceil(10*Math.max(r,i))/10}else n=v.i(e,(function(e){return e.value})),a=v.j(e,(function(e){return e.value}));this.xScale.domain(v.f(e,(function(e){return e.timestamp}))),this.xAxisRef.transition().duration(100).ease(v.d).call(v.b(this.xScale)),this.yScale.domain([a,n]),this.yAxisRef.transition().duration(100).ease(v.d).call(v.c(this.yScale).ticks(n<6?n:6).tickFormat(v.g(".1f")))}},{key:"adjustDimensions",value:function(){this.responsiveHeight&&(this.outerHeight=this.elRef.offsetHeight,this.svg.transition().duration(100).ease(v.d).attr("height",this.outerHeight),this.group.transition().duration(100).ease(v.d).attr("height",this.outerHeight-this.margin.top-this.margin.bottom),this.yScale.range([this.outerHeight-this.margin.bottom,0])),this.responsiveWidth&&(this.outerWidth=this.elRef.offsetWidth,this.svg.transition().duration(100).ease(v.d).attr("width",this.outerWidth),this.group.transition().duration(100).ease(v.d).attr("width",this.outerWidth-this.margin.left-this.margin.right),this.xScale.range([0,this.outerWidth-this.margin.left-this.margin.right]))}}]),e}(),y=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var l;Object(i.a)(this,a),(l=t.call(this,e)).toggleSeries=function(e){var t=e.target;"anomaly"===t.id?l.setState({anomToggled:!l.state.anomToggled}):"prediction"===t.id&&l.setState({predToggled:!l.state.predToggled}),t.classList.toggle("hidden"),l.tsChart.toggleSeries(t.id)},l.updateThreshold=function(e){e.preventDefault();var t=l.thresholdField.value;""!==t&&l.setState({threshold:t})},l.render=function(){return s.a.createElement("div",{className:"card",ref:l.wrapper},s.a.createElement("h2",null,l.state.lastTimeStr?l.state.connected?"".concat(l.props.sensorId.toUpperCase(),": ").concat(l.props.values.signal):"".concat(l.props.sensorId.toUpperCase()):"".concat(l.props.sensorId.toUpperCase()," connecting...")),s.a.createElement("span",{className:"status "+(l.state.connected?"success":"danger")},l.state.error,s.a.createElement("i",{className:"pulse"}),l.state.connected?"Connected":"Disconnected"),s.a.createElement("div",{className:"chart-container "+(l.state.error?"faded":"")}),s.a.createElement("div",{className:"legend"},l.seriesList.map((function(e){return s.a.createElement("span",{id:e.name,key:e.name,className:e.labelClass,onClick:l.toggleSeries},s.a.createElement("i",{className:"box"}),"Anomaly"===e.label&&l.state.anomToggled&&l.state.connected?"".concat(e.label," (T: ").concat(l.state.threshold,")"):"Prediction"===e.label&&l.state.predToggled&&l.state.connected?"".concat(e.label," (dev: ").concat(l.state.data.length>0?l.state.data[l.state.data.length-1].deviation.toFixed(2):0,")"):e.label)}))),s.a.createElement("span",{className:"timestamp "+(l.state.connected?"success":"danger")},l.state.connected?"".concat(l.state.lastDateStr," ").concat(l.state.lastTimeStr):l.state.lastTimeStr?"Last reading was at ".concat(l.state.lastDateStr," ").concat(l.state.lastTimeStr):"No readings registered.."),l.props.pred?[s.a.createElement("div",{className:"threshold-container"},s.a.createElement("hr",{style:{border:"1px solid rgb(230,230,230)",color:"rgb(230,230,230)",backgroundColor:"rgb(230,230,230)",marginBottom:"0px"}}),s.a.createElement("br",null),s.a.createElement("form",{className:"threshold-form",onSubmit:function(e){return l.updateThreshold(e)}},"Anomaly threshold (T):",s.a.createElement("input",{className:"threshold-input",type:"number",name:"threshold",autoComplete:"off",step:"0.01",ref:function(e){return l.thresholdField=e},onClick:function(e){return l.updateThreshold(e)}}),s.a.createElement("button",{className:"threshold-submit",onClick:function(e){return l.updateThreshold(e)}},"Update")))]:null)},l.seriesList=[{name:"sensor-data",type:"LINE",stroke:"#038C7E",strokeWidth:5,label:"Reading",labelClass:"readings"}],l.props.pred&&l.seriesList.push({name:"prediction",type:"LINE",stroke:"#E67002",strokeWidth:3,label:"Prediction",labelClass:"prediction"},{name:"anomaly",type:"AREA",fill:"rgba(216, 13, 49, 0.35)",stroke:"transparent",strokeWidth:0,label:"Anomaly",labelClass:"anomaly"});var r=0;return l.props.examples&&("me1_exhausttemp1"===l.props.sensorId&&(r=6.5),"me1_exhausttemp2"===l.props.sensorId&&(r=15)),l.tsChart=new S,l.wrapper=Object(n.createRef)(),l.updateThreshold=l.updateThreshold.bind(Object(c.a)(l)),l.state={data:[],lastDatetime:null,lastTimeStr:"",lastDateStr:"",connected:!1,error:"",threshold:r,predToggled:!0,anomToggled:!0},l}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this.wrapper.current;this.tsChart.init({elRef:e.getElementsByClassName("chart-container")[0],classList:{svg:"anomaly_chart"}}),this.tsChart.addSeries(this.seriesList[0]),this.props.pred&&(this.tsChart.addSeries(this.seriesList[1]),this.tsChart.addSeries(this.seriesList[2])),this.attachFocusWatcher()}},{key:"componentDidUpdate",value:function(e,t){this.updateChart()}},{key:"attachFocusWatcher",value:function(){window.focused=!0,window.onblur=function(){window.focused=!1},window.onfocus=function(){window.focused=!0}}},{key:"updateChart",value:function(){var e=Math.max(this.state.data.length-(this.props["x-ticks"]||30),0),t=this.state.data.slice(e),a=Math.max.apply(Math,Object(h.a)(t.map((function(e){return e.value}))));if(this.props.pred){var n=Math.max.apply(Math,Object(h.a)(t.map((function(e){return e.pred}))));a=Math.max(a,n)}var s=t.map((function(e){return{timestamp:e.timestamp,value:e.anomaly?a:0}}));this.tsChart.adjustAxes(t,this.props.pred),this.tsChart.setSeriesData("sensor-data",t,!1),this.props.pred&&(this.tsChart.setSeriesData("anomaly",s,!1),this.tsChart.setSeriesData("prediction",t,!1))}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(null===e.values.time)return{lastTimeStr:"",lastDateStr:"",connected:!1};var a,n,s;n=(a=!!e.connected)?"":"Error: No new values found";var l=e.values;s=a?new Date(l.time):t.lastDatetime;var r=t.threshold,i=Date.parse(s),o=s.toLocaleDateString("en-GB"),c=s.toLocaleTimeString("en-GB"),d=t.data,u=Math.max(d.length-50,0),p="";if(t.data.length>0&&(p=t.data[t.data.length-1].timestamp),i!==p){var m={timestamp:i,value:l.signal};return e.pred&&(m.pred=l.pred,m.deviation=Math.abs(m.value-m.pred),m.anomaly=0===r?0:m.deviation>r?1:0),d.push(m),{data:d.slice(u),connected:a,error:n,lastDatetime:s,lastDateStr:o,lastTimeStr:c}}return{data:d.slice(u),connected:a,error:n,lastDatetime:s,lastDateStr:o,lastTimeStr:c}}}]),a}(s.a.Component),E=a(66),x=a.n(E),k=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).connect=function(){n.socket=x.a.connect("/?system=".concat(n.system))},n.onReload=function(){window.performance&&1===performance.navigation.type&&fetch("reload")},n.setSignalSelection=function(){var e,t=n.state.options,a=n.outputs,s=Object(h.a)(new Set([].concat(Object(h.a)(n.inputs),Object(h.a)(n.outputs)))),l=Object(m.a)(s);try{for(l.s();!(e=l.n()).done;){var r=e.value;t.push({label:a.includes(r)?"".concat(r," (with prediction)"):r,value:r})}}catch(i){l.e(i)}finally{l.f()}n.setState({options:t,allSignals:s})},n.addChart=function(e,t,a,n,l,r){return s.a.createElement(y,{sensorId:e,key:t,pred:a,examples:n,connected:l,values:r})},n.addNewCharts=function(e,t,a){var s,l=Object(m.a)(e);try{for(l.s();!(s=l.n()).done;){var r=s.value,i=n.outputs.includes(r);t[r]=n.addChart(r,r,i,n.exampleFiles,a,{id:null,time:null,signal:null,pred:null})}}catch(o){l.e(o)}finally{l.f()}return t},n.deleteDeselectedCharts=function(e,t){var a,n=Object(m.a)(e);try{for(n.s();!(a=n.n()).done;){delete t[a.value]}}catch(s){n.e(s)}finally{n.f()}return t},n.getValues=function(){n.state.selected.length>0&&n.socket.on("values",(function(e){return n.checkReading(e)}))},n.checkReading=function(e){var t=n.state.connected;!1===e&&(n.socket.disconnect(),n.setState({connected:!1}),t=!1),n.storeReading(e,t)},n.storeReading=function(e,t){var a,s={},l=n.state.selected,r=e.time,i=e.id,o=Object(m.a)(l);try{for(o.s();!(a=o.n()).done;){var c=a.value,d=n.outputs.includes(c);s[c]=n.addChart(c,c,d,n.exampleFiles,t,{id:i,time:r,signal:e[c],pred:d?e["".concat(c,"_pred")]:null})}}catch(u){o.e(u)}finally{o.f()}n.setState({chartItems:s})},n.setUpdatedState=function(e,t){t?(n.connect(),n.setState({chartItems:e,connected:!0}),fetch("start_thread"),n.getValues()):n.setState({chartItems:e})},n.state={selected:[],options:[],chartItems:{},connected:!1,allSignals:[],thread_created:!1,error:!1},n.system=n.props.system,n.inputs=n.props.inputs,n.outputs=n.props.outputs,n.timesteps=n.props.modelTimesteps,n.exampleFiles=n.props.exampleFiles,n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this;fetch("keras_model/".concat(this.exampleFiles)),fetch("scaler/".concat(this.exampleFiles));var t=this.inputs.join(","),a=this.outputs.join(",");this.onReload(),fetch("create_thread/".concat(this.system,"/").concat(t,"/").concat(a)).then((function(t){return t.json().then((function(t){t.thread_created?(e.setSignalSelection(),e.setState({thread_created:t.thread_created})):e.setState({thread_created:t.thread_created,error:!0})}))}))}},{key:"componentDidUpdate",value:function(e,t){var a=!1,n=!1,s=this.state.selected,l=this.state.connected,r=this.state.chartItems,i=s.filter((function(e){return!t.selected.includes(e)})),o=t.selected.filter((function(e){return!s.includes(e)}));i.length>0&&(l||(n=!0),a=!0,r=this.addNewCharts(i,r,l)),o.length>0&&(a=!0,r=this.deleteDeselectedCharts(o,r)),a&&this.setUpdatedState(r,n)}},{key:"componentWillUnmount",value:function(){this.state.connected&&this.socket.disconnect()}},{key:"render",value:function(){var e=this,t=this.state.selected,a=this.state.options,n=this.state.chartItems,l=this.state.error,r=0===Object.keys(this.state.allSignals).length,i=this.state.thread_created;return s.a.createElement("div",{className:"selector-chart-container"},s.a.createElement("div",{className:"selector-container"},s.a.createElement(g.a,{id:"selector",options:a,selected:t,onSelectedChanged:function(t){return e.setState({selected:t})},overrideStrings:{selectSomeItems:l&&!i?"Failed to create threading. Please reload the page":i?r?"No signals found..":"Select signals":"Initializing, please wait..",allItemsAreSelected:"Showing all signals",selectAll:"Select all"},disableSearch:!0,isLoading:!(!r&&i)})),s.a.createElement("div",{className:"charts-container"},Object.values(n)))}}]),a}(s.a.Component),O=function(e){return s.a.createElement("div",{className:"header-container"},s.a.createElement("div",{className:"homebtn-container"},s.a.createElement("button",{className:"homebtn",onClick:function(){window.location.reload(!0)}},s.a.createElement("i",{className:"fa fa-home"}))),s.a.createElement("h1",null,e.about?"ABOUT":"ANOMALY DETECTION ".concat(e.dashboard?"DASHBOARD":"START PAGE")),e.about?[s.a.createElement("div",{id:"link-container"},s.a.createElement("h4",{className:"repotitle"},"GITHUB REPOSITORIES"),s.a.createElement("span",null,s.a.createElement("a",{href:"https://github.com/johanfal/rv-gunnerus-anomaly-detection-web-application",target:"_blank",rel:"noopener noreferrer"},"[ Web Application ]"),"\xa0\xa0\xa0\xa0\xa0\xa0\xa0 \xa0\xa0\xa0\xa0\xa0\xa0",s.a.createElement("a",{href:"https://github.com/johanfal/rv-gunnerus-anomaly-detection-modeling-api",target:"_blank",rel:"noopener noreferrer"},"[ Modeling API ]")))]:null)},w=a(12),j=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).onSelect=function(e){var t=n.maxSelect;e.length>t?alert("You can only select ".concat(t," system.")):(n.setState({selected:e}),n.props.sendSystemUpdate(e))},n.onSelectedInput=function(e){n.setState({selectedInputs:e}),n.props.sendInputsUpdate(e)},n.onSelectedOutput=function(e){n.setState({selectedOutputs:e}),n.props.sendOutputsUpdate(e)},n.onContinue=function(){var e={selectedSystem:n.state.selected,selectedInputs:n.state.selectedInputs,selectedOutputs:n.state.selectedOutputs};n.props.sendModelSelections(e)},e.useExampleFiles?(n.state={options:[],selected:["Nogva Engines"],selectedInputs:[],selectedOutputs:[]},n.props.sendSystemUpdate(n.state.selected)):n.state={options:[],selected:[],selectedInputs:[],selectedOutputs:[]},n.maxSelect=1,n.onSelectedInput=n.onSelectedInput.bind(Object(c.a)(n)),n.onSelectedOutput=n.onSelectedOutput.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this;fetch("systems").then((function(t){return t.json().then((function(t){for(var a=[],n=[],s=[],l=0,r=Object.entries(t.systems);l<r.length;l++){var i=Object(w.a)(r[l],2),o=i[0],c=i[1];c?n.push({label:c?o:"".concat(o," (has no data)"),value:o,disabled:!1}):s.push({label:"".concat(o," (has no data)"),value:o,disabled:!0}),a=n.concat(s)}e.setState({options:a})}))}))}},{key:"render",value:function(){var e=this,t=this.state.options,a=this.state.selected,n=this.maxSelect,l=a.length===n,r=this.state.selectedInputs.length===this.props.inputSignals,i=this.state.selectedOutputs.length===this.props.outputSignals,o=t.length>0,c=i&&r&&o,d=this.props.useExampleFiles,u=this.props.inputSignals,p=this.props.outputSignals;return s.a.createElement("div",{className:"system-selector-container"},s.a.createElement("div",{className:"mod-selector-container"},s.a.createElement("div",{className:"mod-spec-text"},d?"System on R/V Gunnerus used in example model:":"Select system on R/V Gunnerus from database:"),s.a.createElement(g.a,{className:"model_selector",options:t,selected:o?a:[],onSelectedChanged:function(t){return e.onSelect(t)},overrideStrings:{selectSomeItems:o?"Select system":"Loading systems from database, please wait..",allItemsAreSelected:"".concat(n>1?"All systems selected":a)},hasSelectAll:n>1,disableSearch:!1,isLoading:!o})),s.a.createElement("div",{className:"io-selector-container"},l?s.a.createElement(N,{system:a,type:"input",maxSelect:u,sendUpdate:function(t){return e.onSelectedInput(t)},useExampleFiles:d}):null,l?s.a.createElement(N,{system:a,type:"output",maxSelect:p,sendUpdate:function(t){return e.onSelectedOutput(t)},useExampleFiles:d}):null,s.a.createElement("div",{className:"continue-with-IO"},l?s.a.createElement("button",{id:"continue-with-IO",ref:function(t){e.contBtn=t},disabled:!c,onClick:function(){return e.onContinue()},type:"submit"},s.a.createElement("span",{id:"cont-btn"},"Continue")):null)))}}]),a}(s.a.Component),N=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).onSelect=function(e){var t=n.props.maxSelect,a=n.props.type,s=Math.max(n.SIGNAL_MAX,t);n.props.useExampleFiles?alert("The ".concat(a," signals area already set for the example model.")):e.length>t?alert("Maximum specified ".concat(a," signals in your model is ").concat(t,"!")):e.length>s?alert("The maximum number of signals is set to ".concat(s," to ")+"preserve server capabilities."):(n.setState({selected:e}),n.props.sendUpdate(e))},e.useExampleFiles?("input"===e.type&&(n.state={options:[],selected:["me1_backupbatt","me1_boostpress","me1_enginespeed","me1_exhausttemp1","me1_exhausttemp2","me1_fuelrate","me1_hours","me1_lopress","me1_luboiltemp","me1_power","me1_startbatt","me1_coolanttemp"]}),"output"===e.type&&(n.state={options:[],selected:["me1_exhausttemp1","me1_exhausttemp2"]})):n.state={options:[],selected:[]},n.SIGNAL_MAX=20,n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this;fetch("signals/".concat(this.props.system)).then((function(t){return t.json().then((function(t){var a,n=[],s=Object(m.a)(t.signals);try{for(s.s();!(a=s.n()).done;){var l=a.value;"id"!==l&&"time"!==l&&n.push({label:l,value:l})}}catch(r){s.e(r)}finally{s.f()}e.setState({options:n}),e.props.useExampleFiles&&e.props.sendUpdate(e.state.selected)}))}))}},{key:"render",value:function(){var e=this,t=this.state.options,a=this.state.selected,n=this.props.type,l=this.props.maxSelect,r="input"===n?n:"predicted output",i=r.charAt(0).toUpperCase()+r.slice(1),o=t.length>0,c=this.props.system,d=this.props.useExampleFiles;return s.a.createElement("div",{className:"mod-selector-container"},s.a.createElement("div",{className:"mod-spec-text"},d?"".concat(i," signals used in example model ")+"(".concat(a.length," in total):"):"Select the ".concat(r," signals used by your ML model (")+"".concat(a.length," of ").concat(l," selected):")),s.a.createElement(g.a,{className:"model_selector",id:n,options:t,selected:o?a:[],onSelectedChanged:function(t){return e.onSelect(t)},overrideStrings:{selectSomeItems:o?"Select ".concat(r," signals used by your ML model"):"Loading ".concat(n," signals from ").concat(c,", please wait.."),allItemsAreSelected:"".concat(l>1?"All ".concat(n," signals selected"):a)},hasSelectAll:l>1&&!d,disableSearch:!1,isLoading:!o}))}}]),a}(s.a.Component),C=a(69),I=a(68),F={position:"relative",display:"inline-block",width:"275px",textAlign:"center",verticalAlign:"middle",padding:"10px 30px 10px 30px",margin:"20px",borderWidth:2,borderRadius:4,borderColor:"#eeeeee",borderStyle:"dashed",outline:"none",transition:"border .24s ease-in-out"},A={borderColor:"#00b3a1"},T=/(?:\.([^.]+))?$/,U=function(e){var t=e.format.replace(",","/"),a=Object(n.useState)(!1),l=Object(w.a)(a,2),r=l[0],i=l[1],o=Object(n.useState)(null),c=Object(w.a)(o,2),d=c[0],u=c[1],p=Object(n.useState)({}),m=Object(w.a)(p,2),h=m[0],f=m[1],g=Object(n.useState)(!1),v=Object(w.a)(g,2),b=v[0],S=v[1],y=Object(n.useCallback)((function(a,n){if(E(),a.length>1)alert("You attempted to upload more than one '".concat(t,"' file."));else if(n.length>0)if(n.length>1||a.length>0)alert("You attempted to upload more than one file.");else if("file-too-large"===n[0].errors[0].code)alert("You have attempted to upload a file that exceeds the maximum"+" allowed file size of ".concat(parseInt(100)," MB."));else{var s=T.exec(n[0].file.name)[0];alert("You attempted to upload a file with format "+"'".concat(s,"'. Make sure you upload a file with ")+"format '".concat(t,"' instead."))}else if(1===a.length){var l=new FormData,r=a[0].name,o=T.exec(r)[0];l.append("file",a[0]),l.append("filename",r),i(!0),e.sendFilename(r,e.id),"keras-model"===e.id&&x(l),"scaler"===e.id&&k(l);var c=r.length,d=o.length;c>19+d&&(r=r.substring(0,15)+"..."+r.substring(c-d-3,c-d)+o),u(r)}})),E=function(){e.resetProps(e.id),i(!1),u(null),f({}),S(!1)},x=function(t){fetch("keras_model/".concat(!1),{method:"POST",body:t}).then((function(t){t.json().then((function(t){if(!1!==t.fileprops){var a={inp:t.fileprops.inp,out:t.fileprops.out,timesteps:t.fileprops.timesteps};f(a),e.sendModelProperties(a)}else f(!1),e.sendFilename(null,e.id),e.sendModelProperties({input:null,output:null,timesteps:null});S(!0)}))}))},k=function(t){fetch("scaler/".concat(!1),{method:"POST",body:t}).then((function(t){t.json().then((function(t){!1!==t.fileprops?f({type:t.fileprops.type,features:t.fileprops.features,samples:t.fileprops.samples}):(f(!1),e.sendFilename(null,e.id)),S(!0)}))}))};Object(n.useEffect)((function(){e.useExampleFiles&&(i(!0),"keras-model"===e.id&&(u("example_model.h5"),fetch("keras_model/".concat(!0)).then((function(t){t.json().then((function(t){var a={inp:t.fileprops.inp,out:t.fileprops.out,timesteps:t.fileprops.timesteps};f(a),e.sendModelProperties(a),S(!0)}))}))),"scaler"===e.id&&(u("example_scaler.pckl"),fetch("scaler/".concat(!0)).then((function(e){e.json().then((function(e){f({type:e.fileprops.type,features:e.fileprops.features,samples:e.fileprops.samples}),S(!0)}))}))))}),[e.useExampleFiles]);var O,j=Object(I.a)({accept:e.format,onDrop:y,minSize:0,maxSize:parseInt(104857599.604863)}),N=j.getRootProps,U=j.getInputProps,_=j.isDragActive,D=Object(n.useMemo)((function(){return Object(C.a)({},F,{},_?A:{})}),[_]);return s.a.createElement("div",{className:"upload-container"},s.a.createElement("div",{className:"question-container"},s.a.createElement("div",{className:"tooltip-container"},"keras-model"===e.id?s.a.createElement("span",{className:"tooltiptext",id:"model-tooltip"},"Keras models are saved in .h5-format, and contain necessary weights and biases to predict new values. It is important that the model is applied to the same parameters that was used during training. The predicted outcome will correspond with chosen output columns when training the model. Read more about Keras models"," ",s.a.createElement("a",{className:"tooltip-link",href:"https://keras.io/api/",target:"_blank",rel:"noopener noreferrer"},"here"),"."):s.a.createElement("span",{className:"tooltiptext",id:"scaler-tooltip"},"A scaler is used to normalize data, which is essential when different features have different ranges. The application supports scalers from sklearn's peprocessing API. Scalers have no internal method for saving. Therefore, Python's pickle module (.pckl) should be used to pickle the scaler instead. Read more about scalers and preprocessing"," ",s.a.createElement("a",{className:"tooltip-link",href:"https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing",target:"_blank",rel:"noopener noreferrer"},"here"),".")),s.a.createElement("a",{className:"question-tooltip"},"?")),s.a.createElement("div",Object.assign({},N({style:D}),{className:"upload"}),s.a.createElement("input",U()),r?[s.a.createElement("div",null,s.a.createElement("br",null),e.name.charAt(0).toUpperCase()+e.name.slice(1),s.a.createElement("div",{style:{color:"rgb(71, 255, 71)"}},"'",d,"' uploaded."),s.a.createElement("br",null),s.a.createElement("div",null,(O=e.id,h?"keras-model"===O?b?s.a.createElement("div",{id:"model-upload-properties"},s.a.createElement("em",null,"Specifications found for uploaded model:"),s.a.createElement("br",null),"Number of input columns: ",h.inp," ",s.a.createElement("br",null),"Number of predicted output columns: ",h.out," ",s.a.createElement("br",null),"Timesteps used per prediction: ",h.timesteps," ",s.a.createElement("br",null)):s.a.createElement("em",null,s.a.createElement("br",null),"Reading model parameters.."):"scaler"===O?b?s.a.createElement("div",{id:"model-upload-properties"},s.a.createElement("em",null,"Specifications found for uploaded scaler:"),s.a.createElement("br",null),"Scaler type: ",h.type," ",s.a.createElement("br",null),"Number of columns scaled: ",h.features," ",s.a.createElement("br",null),"Samples experienced by scaler: ",h.samples," ",s.a.createElement("br",null)):s.a.createElement("em",null,s.a.createElement("br",null),"Reading scaler parameters.."):void 0:s.a.createElement("div",{id:"fileprops-error",style:{color:"red"}},s.a.createElement("br",null),s.a.createElement("em",null,"Could not read ",e.name," properties..")))))]:[s.a.createElement("div",null,s.a.createElement("br",null),"Drag and drop ",e.name," here,",s.a.createElement("br",null),"or click to select from files.",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("br",null),"(",s.a.createElement("em",null,"File format must be ",t),")")]))},_=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).onModelComplete=function(e){n.setState({selectedSystem:e.selectedSystem,selectedInputs:e.selectedInputs,selectedOutputs:e.selectedOutputs,settingsComplete:!0})},n.onFileUploaded=function(e,t){"keras-model"===t&&n.setState({modelFilename:e}),"scaler"===t&&n.setState({scalerFilename:e})},n.onModelProperties=function(e){n.setState({modelProperties:e})},n.setExampleBool=function(){n.state.useExampleFiles||n.setState({useExampleFiles:!0,modelFilename:"example_model.h5",scalerFilename:"example_scaler.pckl"})},n.resetUploadStates=function(e){"keras-model"===e&&n.setState({selectedSystem:[],selectedInputs:[],selectedOutputs:[],useExampleFiles:!1,modelFilename:null,modelProperties:{input:null,output:null,timesteps:null}}),"scaler"===e&&n.setState({selectedSystem:[],selectedInputs:[],selectedOutputs:[],useExampleFiles:!1,scalerFilename:null})},n.onSystemUpdate=function(e){n.setState({selectedSystem:e})},n.onInputsUpdate=function(e){n.setState({selectedInputs:e})},n.onOutputsUpdate=function(e){n.setState({selectedOutputs:e})},n.onAboutClick=function(){n.setState({about:!n.state.about})},n.state={selectedSystem:[],selectedInputs:[],selectedOutputs:[],useExampleFiles:!1,settingsComplete:!1,modelFilename:null,scalerFilename:null,modelProperties:{input:null,output:null,timesteps:null},about:!1},n.onModelComplete=n.onModelComplete.bind(Object(c.a)(n)),n.onFileUploaded=n.onFileUploaded.bind(Object(c.a)(n)),n.onInputsUpdate=n.onInputsUpdate.bind(Object(c.a)(n)),n.onOutputsUpdate=n.onOutputsUpdate.bind(Object(c.a)(n)),n.onSystemUpdate=n.onSystemUpdate.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"render",value:function(){var e=this,t=this.state.settingsComplete,a=this.state.useExampleFiles,n=this.state.modelProperties,l=this.state.selectedSystem[0],r=this.state.selectedInputs,i=this.state.selectedOutputs,o=this.state.modelFilename,c=this.state.modelProperties.timesteps,d=this.state.scalerFilename,u=this.state.about,m=!!o&&!!d;return s.a.createElement("div",{className:"startpage"},s.a.createElement("div",{className:"about-button-container"},s.a.createElement("button",{id:"about-btn",onClick:this.onAboutClick},u?"Back":"About")),s.a.createElement(O,{dashboard:t,about:u}),u?s.a.createElement(p,null):t?s.a.createElement(k,{system:l,inputs:r,outputs:i,exampleFiles:a,modelFilename:o,modelTimesteps:c,scalerFilename:d}):[s.a.createElement("div",null,s.a.createElement("div",{id:"upload-content"},s.a.createElement(U,{id:"keras-model",key:"keras-model-upload",name:"Keras model",format:".HDF5,.h5",sendFilename:function(t,a){return e.onFileUploaded(t,a)},useExampleFiles:a,resetProps:function(t){return e.resetUploadStates(t)},sendModelProperties:function(t){return e.onModelProperties(t)}}),s.a.createElement(U,{id:"scaler",key:"scaler-upload",name:"scaler",format:".pckl",sendFilename:function(t,a){return e.onFileUploaded(t,a)},useExampleFiles:a,resetProps:function(t){return e.resetUploadStates(t)}})),s.a.createElement("div",null,s.a.createElement("p",{style:{textAlign:"center",color:"white"}},"Or use\xa0",s.a.createElement("a",{className:"example-link",onClick:function(){return e.setExampleBool()}},"example model and scaler"))),s.a.createElement("div",{className:"model-selectors-container"},m?s.a.createElement(j,{inputSignals:n.inp,outputSignals:n.out,sendModelSelections:function(t){return e.onModelComplete(t)},sendSystemUpdate:function(t){return e.onSystemUpdate(t)},sendInputsUpdate:function(t){return e.onInputsUpdate(t)},sendOutputsUpdate:function(t){return e.onOutputsUpdate(t)},useExampleFiles:a}):null))])}}]),a}(s.a.Component);var D=function(){return s.a.createElement("div",{className:"content"},s.a.createElement("div",{id:"maincontent"},s.a.createElement(_,null)))};r.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(D,null)),document.getElementById("root"))},49:function(e,t,a){}},[[114,1,2]]]);
//# sourceMappingURL=main.3cc93a39.chunk.js.map